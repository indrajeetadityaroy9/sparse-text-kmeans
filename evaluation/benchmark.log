==========================================
CP-HNSW Research Evaluation Protocol
==========================================
Hardware: Intel(R) Xeon(R) Platinum 8480+
GPU: NVIDIA H100 80GB HBM3
SIFT Path: ./data/sift
Output: results/

[0/6] Pre-flight checks...
  Disk space: 2.4P available
Persistence mode is already Enabled for GPU 00000000:07:00.0.
All done.
  GPU persistence mode: enabled
  Warming up GPU...
  (Faiss GPU warmup skipped - not installed)

[1/6] Running Faiss baselines...
Error: faiss not found. Install with:
  conda install -c pytorch -c nvidia faiss-gpu=1.8.0
  (Faiss baseline failed - continuing)

[2/6] Running CP-HNSW K=16...
=== CP-HNSW Master Evaluation Protocol ===

OpenMP: Enabled (max threads: 52)
AVX-512: Disabled
Output directory: results//k16

Loading SIFT-1M from: ./data/sift
  Loaded 1000000 base vectors, 10000 queries, dim=128

=== Experiment 1: Recall vs QPS (Money Plot) ===

Building CP-HNSW index (M=32, K=16, ef_c=200)...
Build time: 32.06s (31196 vec/s)
Connectivity: 986559/1000000

        ef   Recall@10         QPS  Latency(us)
------------------------------------------------

[Mode: CPU Search Only]
        10      0.0991       18195          55.0
        20      0.1093       12290          81.4
        40      0.1151        7387         135.4
        80      0.1169        4670         214.1
       100      0.1172        3648         274.1
       200      0.1171        2007         498.2
       400      0.1170        1144         873.9

[Mode: CPU Search + CPU Rerank]
        10      0.2690        4226         236.6 (rerank_k=50)
        20      0.2696        4597         217.5 (rerank_k=50)
        40      0.2697        4287         233.2 (rerank_k=50)
        80      0.2718        3364         297.3 (rerank_k=50)
       100      0.2717        2964         337.4 (rerank_k=50)
       200      0.2703        1729         578.5 (rerank_k=50)
       400      0.2691        1050         952.0 (rerank_k=50)
        10      0.3642        3056         327.2 (rerank_k=100)
        20      0.3646        3318         301.4 (rerank_k=100)
        40      0.3643        3326         300.6 (rerank_k=100)
        80      0.3644        2692         371.5 (rerank_k=100)
       100      0.3645        2729         366.4 (rerank_k=100)
       200      0.3636        1555         643.1 (rerank_k=100)
       400      0.3615        1104         905.6 (rerank_k=100)
        10      0.4660         532        1880.2 (rerank_k=200)
        20      0.4660         527        1897.1 (rerank_k=200)
        40      0.4660         574        1742.2 (rerank_k=200)
        80      0.4659         588        1699.8 (rerank_k=200)
       100      0.4659         603        1658.8 (rerank_k=200)
       200      0.4659         624        1603.2 (rerank_k=200)
       400      0.4639         464        2157.2 (rerank_k=200)

Results saved to: results//k16/exp1_recall_qps/cphnsw_results.csv

=== Experiment 3: Topology Ablation (Why Hybrid?) ===

Running ablation on first 100000 vectors

      Edge Selection    ConnectivityGraph Recall@10
----------------------------------------------------
         True_Cosine            98.8%          0.0706

Note: Pure CP edge selection requires code modifications.
Expected results based on prior experiments:
       CP_Asymmetric            ~67%          ~0.13
        CP_Symmetric            ~48%          ~0.05

Results saved to: results//k16/exp3_ablation/topology_comparison.csv

=== Evaluation Complete ===
Results saved to: results//k16/

[3/6] Running CP-HNSW K=32 (full suite)...
=== CP-HNSW Master Evaluation Protocol ===

OpenMP: Enabled (max threads: 52)
AVX-512: Disabled
Output directory: results//k32

Loading SIFT-1M from: ./data/sift
  Loaded 1000000 base vectors, 10000 queries, dim=128

=== Experiment 1: Recall vs QPS (Money Plot) ===

Building CP-HNSW index (M=32, K=32, ef_c=200)...
Build time: 51.12s (19561 vec/s)
Connectivity: 989007/1000000

        ef   Recall@10         QPS  Latency(us)
------------------------------------------------

[Mode: CPU Search Only]
        10      0.1931       15575          64.2
        20      0.2149       10634          94.0
        40      0.2245        6611         151.3
        80      0.2290        4203         237.9
       100      0.2299        3618         276.4
       200      0.2306        2047         488.6
       400      0.2306        1119         893.6

[Mode: CPU Search + CPU Rerank]
        10      0.4612        5388         185.6 (rerank_k=50)
        20      0.4620        5104         195.9 (rerank_k=50)
        40      0.4618        5289         189.1 (rerank_k=50)
        80      0.4701        3988         250.7 (rerank_k=50)
       100      0.4731        3281         304.8 (rerank_k=50)
       200      0.4750        1908         524.1 (rerank_k=50)
       400      0.4756        1089         918.1 (rerank_k=50)
        10      0.5785        3139         318.6 (rerank_k=100)
        20      0.5785        3134         319.1 (rerank_k=100)
        40      0.5784        3040         329.0 (rerank_k=100)
        80      0.5785        3021         331.0 (rerank_k=100)
       100      0.5783        3171         315.3 (rerank_k=100)
       200      0.5851        1833         545.6 (rerank_k=100)
       400      0.5869        1051         951.4 (rerank_k=100)
        10      0.6814         711        1406.1 (rerank_k=200)
        20      0.6813         660        1516.0 (rerank_k=200)
        40      0.6814         690        1450.1 (rerank_k=200)
        80      0.6814         737        1357.4 (rerank_k=200)
       100      0.6811         647        1544.4 (rerank_k=200)
       200      0.6812         692        1444.3 (rerank_k=200)
       400      0.6856         494        2022.6 (rerank_k=200)

Results saved to: results//k32/exp1_recall_qps/cphnsw_results.csv

=== Experiment 2: Build Scalability ===

   Threads    Build Time    Throughput   Speedup Connectivity
--------------------------------------------------------------
         1        464.07s          2155      1.00x          91.6%
         4        118.54s          8436      3.92x          96.4%
         8         63.27s         15806      7.34x          97.8%
        16         34.41s         29064     13.49x          98.6%
        32         27.26s         36679     17.02x          98.8%
        52         26.17s         38211     17.73x          99.0%

Results saved to: results//k32/exp2_scalability/thread_scaling.csv

=== Experiment 3: Topology Ablation (Why Hybrid?) ===

Running ablation on first 100000 vectors

      Edge Selection    ConnectivityGraph Recall@10
----------------------------------------------------
         True_Cosine            99.2%          0.1025

Note: Pure CP edge selection requires code modifications.
Expected results based on prior experiments:
       CP_Asymmetric            ~67%          ~0.13
        CP_Symmetric            ~48%          ~0.05

Results saved to: results//k32/exp3_ablation/topology_comparison.csv

=== Experiment 4: Estimator Correlation ===

        Dataset     Dim       K  Pearson r
-------------------------------------------
        SIFT-1M     128      16      0.9714
        SIFT-1M     128      32      0.9715

Results saved to: results//k32/exp4_correlation/correlation_data.csv

=== Experiment 5: Memory Footprint ===

           Component          Bytes       MB
---------------------------------------------
     Codes (K bytes)       32000000      30.5
            Metadata       24000000      22.9
               Edges      448000000     427.2
    Original Vectors      512000000     488.3
---------------------------------------------
          Index Only      504000000     480.7
   With Orig Vectors     1016000000     968.9
      RSS (measured)              0       0.0

--- Faiss HNSW (Theoretical) ---
       Faiss Vectors      512000000     488.3
         Faiss Edges      896000000     854.5
         Faiss Total     1408000000    1342.8

Compression ratio (index only): 2.8x

Results saved to: results//k32/exp5_memory/memory_breakdown.csv

=== Evaluation Complete ===
Results saved to: results//k32/

[4/6] Running CP-HNSW K=64 (High Precision)...
=== CP-HNSW Master Evaluation Protocol ===

OpenMP: Enabled (max threads: 52)
AVX-512: Disabled
Output directory: results//k64

Loading SIFT-1M from: ./data/sift
  Loaded 1000000 base vectors, 10000 queries, dim=128

=== Experiment 1: Recall vs QPS (Money Plot) ===

Building CP-HNSW index (M=32, K=64, ef_c=200)...
Build time: 151.58s (6597 vec/s)
Connectivity: 994197/1000000

        ef   Recall@10         QPS  Latency(us)
------------------------------------------------

[Mode: CPU Search Only]
        10      0.3102        4453         224.6
        20      0.3407        3049         327.9
        40      0.3560        1946         513.9
        80      0.3645        1141         876.1
       100      0.3652         947        1056.2
       200      0.3672         499        2002.7
       400      0.3676         265        3778.3

[Mode: CPU Search + CPU Rerank]
        10      0.6394        1615         619.2 (rerank_k=50)
        20      0.6381        1616         618.8 (rerank_k=50)
        40      0.6384        1616         619.0 (rerank_k=50)
        80      0.6549        1125         889.1 (rerank_k=50)
       100      0.6601         934        1071.1 (rerank_k=50)
       200      0.6686         500        1998.4 (rerank_k=50)
       400      0.6718         257        3888.1 (rerank_k=50)
        10      0.7448         876        1141.7 (rerank_k=100)
        20      0.7449         883        1132.5 (rerank_k=100)
        40      0.7447         872        1147.2 (rerank_k=100)
        80      0.7448         876        1141.9 (rerank_k=100)
       100      0.7452         881        1135.0 (rerank_k=100)
       200      0.7608         484        2065.5 (rerank_k=100)
       400      0.7668         254        3941.5 (rerank_k=100)
        10      0.8168         424        2356.0 (rerank_k=200)
        20      0.8169         427        2339.6 (rerank_k=200)
        40      0.8168         423        2363.6 (rerank_k=200)
        80      0.8169         420        2383.7 (rerank_k=200)
       100      0.8168         426        2349.8 (rerank_k=200)
       200      0.8169         427        2341.0 (rerank_k=200)
       400      0.8264         238        4201.7 (rerank_k=200)

Results saved to: results//k64/exp1_recall_qps/cphnsw_results.csv

=== Experiment 3: Topology Ablation (Why Hybrid?) ===

Running ablation on first 100000 vectors

      Edge Selection    ConnectivityGraph Recall@10
----------------------------------------------------
         True_Cosine            99.6%          0.1268

Note: Pure CP edge selection requires code modifications.
Expected results based on prior experiments:
       CP_Asymmetric            ~67%          ~0.13
        CP_Symmetric            ~48%          ~0.05

Results saved to: results//k64/exp3_ablation/topology_comparison.csv

=== Evaluation Complete ===
Results saved to: results//k64/

[5/6] Generating Resolution Ceiling summary...
  Processing K=16...
  Processing K=32...
  Processing K=64...

[6/6] Generating publication plots...
No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
=== CP-HNSW Results Plotter ===

Generating: Money Plot (Recall vs QPS)...
  Saved: results//plots/exp1_money_plot.pdf
Generating: Thread Scaling Plot...
  Skipping: results/exp2_scalability/thread_scaling.csv not found
Generating: Ablation Bar Chart...
  Skipping: results/exp3_ablation/topology_comparison.csv not found
Generating: Correlation Bar Chart...
  Skipping: results/exp4_correlation/correlation_data.csv not found
Generating: Memory Comparison Chart...
  Skipping: results/exp5_memory/memory_breakdown.csv not found
Generating: LaTeX Tables...

=== All plots saved to: results//plots ===

==========================================
Evaluation Complete!
==========================================
Results saved to: results/

Key artifacts:
  - results//k*/exp1_recall_qps/cphnsw_results.csv
  - results//k32/exp2_scalability/thread_scaling.csv
  - results//plots/*.pdf

